"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports["default"] = exports.useHasImageLoaded = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));

var _core = require("@emotion/core");

var _react = require("react");

var _Box = _interopRequireDefault(require("../Box"));

/** @jsx jsx */
var useHasImageLoaded = function useHasImageLoaded(_ref) {
  var src = _ref.src,
      onLoad = _ref.onLoad,
      onError = _ref.onError;

  var _useState = (0, _react.useState)(false),
      hasLoaded = _useState[0],
      setHasLoaded = _useState[1];

  (0, _react.useEffect)(function () {
    var image = new window.Image();
    image.src = src;

    image.onload = function (event) {
      setHasLoaded(true);
      onLoad && onLoad(event);
    };

    image.onError = function (event) {
      setHasLoaded(false);
      onError && onError(event);
    };
  }, [src, onLoad, onError]);
  return hasLoaded;
};

exports.useHasImageLoaded = useHasImageLoaded;
var NativeImage = (0, _react.forwardRef)(function (_ref2, ref) {
  var htmlWidth = _ref2.htmlWidth,
      htmlHeight = _ref2.htmlHeight,
      alt = _ref2.alt,
      props = (0, _objectWithoutPropertiesLoose2["default"])(_ref2, ["htmlWidth", "htmlHeight", "alt"]);
  return (0, _core.jsx)("img", (0, _extends2["default"])({
    width: htmlWidth,
    height: htmlHeight,
    ref: ref,
    alt: alt
  }, props));
});
var Image = (0, _react.forwardRef)(function (_ref3, ref) {
  var src = _ref3.src,
      fallbackSrc = _ref3.fallbackSrc,
      onError = _ref3.onError,
      onLoad = _ref3.onLoad,
      ignoreFallback = _ref3.ignoreFallback,
      props = (0, _objectWithoutPropertiesLoose2["default"])(_ref3, ["src", "fallbackSrc", "onError", "onLoad", "ignoreFallback"]);
  var hasLoaded = useHasImageLoaded({
    src: src,
    onLoad: onLoad,
    onError: onError
  });
  var imageProps;

  if (ignoreFallback) {
    imageProps = {
      src: src,
      onLoad: onLoad,
      onError: onError
    };
  } else {
    imageProps = {
      src: hasLoaded ? src : fallbackSrc
    };
  }

  return (0, _core.jsx)(_Box["default"], (0, _extends2["default"])({
    as: NativeImage,
    ref: ref
  }, imageProps, props));
});
Image.displayName = "Image";
var _default = Image;
exports["default"] = _default;